#!/usr/bin/env ruby
$LOAD_PATH.unshift(File.expand_path('../../lib', __FILE__))
require 'bundler/setup'
require 'commander/import'
require 'terminal-table'

require 'flabbergast'
require 'flabbergast/grid'
require 'flabbergast/dictionary'
require 'flabbergast/solver'

program :name,        'Flabbergast'
program :version,     '0.0.1'
program :description, 'Generate and solve word grid puzzles'

command :run do |c|
  c.syntax = '[options]'
  c.option '--size NUMBER',  Integer, 'Number letters in each direction on the grid'
  c.option '--file path',  String, 'Path to a grid to solve'
  c.option '--dictionary path',  String, 'Path to a word dictionary'

  c.action do |args, options|
    options.default(
      size: 4,
      dictionary_file: File.expand_path('../../dictionary.txt', __FILE__)
    )

    grid       = Flabbergast::Grid.new(options)
    dictionary = Flabbergast::Dictionary.new(options.dictionary_file)
    solver     = Flabbergast::Solver.new(dictionary, grid.raw_grid)
    words      = solver.solve!
    title = "#{grid.size}x#{grid.size} Wordgrid"
    pretty_grid = Terminal::Table.new(title: title, rows: grid.raw_grid).to_s

    puts pretty_grid
    puts "There were #{words.count} words found."
    words.each { |word| puts word }

  end
end

default_command :run
